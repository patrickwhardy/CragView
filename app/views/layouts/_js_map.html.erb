<%= javascript_tag do %>
  function initMap() {
    var mapDiv = document.getElementById('map');
    var map = new google.maps.Map(mapDiv, {
      center: {lat: 44.540, lng: -78.546},
      zoom: 8
    });

    thePanorama = map.getStreetView();

    streetviewChangeListener = google.maps.event.addListener(thePanorama, 'visible_changed', function() {
                var location = thePanorama.getPosition();
                console.log('streetview panorama position: ' + location);
      });
  }

  $.ajax({
			 method: "POST",
			 url: "/api/v1/crags",
			 dataType: "JSON",
			 data: {crag: {location: "45.5969,-82.0473", name: "New Name"}},
			 success: $('.ajax-flash').html("<div class='alert alert-success'><h4>It worked!</h4></div>")
		 })
<% end %>

<div id="map">
   <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS'] %>&callback=initMap"
       async defer></script>
</div>

<input class="btn btn-default pull-right" id="create-crag" type="button" name="submit" value="Create Crag">
