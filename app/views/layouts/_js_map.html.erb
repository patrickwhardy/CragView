<%= javascript_tag do %>
  var view_location;
  function initMap() {
    var mapDiv = document.getElementById('map');
    var map = new google.maps.Map(mapDiv, {
      center: {lat: 39.682808, lng: -105.982996},
      zoom: 8
    });

    var thePanorama = map.getStreetView();

    streetviewChangeListener = google.maps.event.addListener(thePanorama, 'visible_changed', function() {
                view_location = thePanorama.getPosition();
                console.log('streetview panorama position: ' + location);
      });
  }

  $(document).ready(function(){
    $("#create-crag").on("click", function() {
      var description = $("Description").val();
        $.ajax({
          method: "POST",
          url: "/api/v1/crags",
          dataType: "JSON",
          data: {crag: getData()},
          success: $('.ajax-flash').html("<div class='alert alert-success'><h4>You Successfully Created a New Crag!</h4></div>")
        })
    })
  })

  var getData = function() {
    return {location: view_location.lat() + "," + view_location.lng(), description: $('#Description').val(), name: $('#Name').val(), directions: $('#Directions').val()}
  }

<% end %>

<div id="map">
   <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS'] %>&callback=initMap"
       async defer></script>
</div>

<div class="container map-form">
  <%= text_area_tag "Name", "Name"  %>
  <%= text_area_tag "Description", "Description"  %>
  <%= text_area_tag "Directions", "Directions"  %>
  <button id="create-crag" name="create-crag" class="btn btn-default pull-right">Create Crag</button>
</div>
